- name: Create a new ad user
  azure_rm_msuser:
    user_principal_name: foo@test.com
    display_name: test.test
    account_enabled: True
    mail_nickname: fred
    password_profile:
      Password: Password***
    mail: test@test.com
  register: output

- assert:
    that:
      - output.changed

- name: Get ad user info
  azure_rm_msuser_info:
    attribute_name: displayName
    attribute_value: xiuxi.sun
  register: output

- assert:
    that:
      - output.ms_users[0].display_name == "test.test"
      - output.ms_users[0].mail == "foo@test.com"

- name: Delete microsoft groups
  azure_rm_msuser:
    display_name: test.test
    state: absent 
  register: output

- assert:
    that:
      - output.changed
